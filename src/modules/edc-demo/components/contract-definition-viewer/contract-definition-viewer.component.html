<div *ngIf="filteredContractDefinitions$ | async as contractDefinitions" class="assets-wrapper">
  <div class="search-bar-container">
    <div class="search-left">
      <div class="search-wrapper">
        <input
          class="search-input"
          type="text"
          placeholder="Search Contract Definitions"
          [(ngModel)]="searchText"
          (input)="onSearch()"
        />
        <button class="clear-btn" (click)="searchText=''; onSearch()">
          <span class="material-icons">close</span>
        </button>
      </div>

      <button class="search-button" (click)="onSearch()">
        <span class="material-icons">search</span>
      </button>
    </div>

    <button (click)="onCreate()" mat-raised-button class="create-button">
      <mat-icon>add</mat-icon>
      Create Data Offer
    </button>
  </div>

    <div fxLayout="row wrap" fxLayoutAlign="start start">

        <mat-card *ngFor="let contractDefinition of contractDefinitions" class="contract-definition-card">
            <mat-card-header>
                <mat-icon mat-card-avatar>policy</mat-icon>
                <mat-card-title>{{contractDefinition.id}}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <mat-list dense>
                    <mat-list-item>
                        <mat-icon matListItemIcon>policy</mat-icon>
                        <div class="policy-name" matListItemTitle>Access policy</div>
                        <div matListItemLine>{{contractDefinition.accessPolicyId}}</div>
                    </mat-list-item>
                    <mat-list-item>
                        <mat-icon matListItemIcon>policy</mat-icon>
                        <div class="policy-name" matListItemTitle>Contract policy</div>
                        <div matListItemLine>{{contractDefinition.contractPolicyId}}</div>
                    </mat-list-item>
                </mat-list>

                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Selectors
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <mat-list dense>
                        <mat-list-item *ngFor="let criterion of contractDefinition.assetsSelector">
                            <mat-icon matListItemIcon>check</mat-icon>
                            <!-- mandatoryValue method needs to be used because of this bug: https://github.com/Think-iT-Labs/edc-connector-client/issues/94 -->
                            <div matListItemLine>{{criterion.mandatoryValue('edc', 'operandLeft')}} {{criterion.mandatoryValue('edc', 'operator')}} {{criterion.mandatoryValue('edc', 'operandRight')}}</div>
                        </mat-list-item>
                    </mat-list>
                </mat-expansion-panel>

            </mat-card-content>

            <mat-divider inset></mat-divider>
            <mat-card-actions class="card-actions">
                <button (click)="onDelete(contractDefinition)" color="warn" mat-stroked-button>
                    <mat-icon>delete_sweep</mat-icon> Delete
                </button>
            </mat-card-actions>
        </mat-card>
    </div>
</div>
